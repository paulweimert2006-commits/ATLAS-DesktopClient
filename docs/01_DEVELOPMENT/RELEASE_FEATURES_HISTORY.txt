Governance Phase 1+2 (25.02.2026) - Repository-Absicherung
- Git Tag v2.2.6 auf main gesetzt (Governance Freeze)
- Branch-Strategie: main/beta/dev mit Branch Protection Rules aktiv
- CI-Pipeline: smoke-tests.yml + CodeQL Analysis auf main und beta
- Security: Secret Scanning, Push Protection, Dependabot Alerts aktiviert
- Dokumentation: GIT_GOVERNANCE.md, SYSTEM_OVERVIEW.md korrigiert und erweitert
- Hygiene: RELEASE_FEATURES_HISTORY.txt konsolidiert (Root -> docs/)
- Hygiene: Design-Mockups aus Repo entfernt (.gitignore)
- Smoke Tests: Document-Dataclass-Tests an neue Pflichtfelder angepasst
- Voller PR-Zyklus validiert: dev -> beta -> main mit CI-Gates (PRs #6, #7, #8)
- Dependabot: 21 Alerts dokumentiert, Handlungsbedarf fuer cryptography/requests identifiziert

v2.2.5 (24.02.2026) - Performance & Stabilitaet
- Performance: Update-Check beim App-Start ist jetzt asynchron (kein UI-Freeze mehr bei langsamer Verbindung)
- Performance: Outlook Drag&Drop-Extraktion laeuft im Hintergrund-Thread (kein UI-Freeze bei vielen E-Mails)
- Performance: PDF-Thumbnails werden im Hintergrund gerendert (kein UI-Freeze bei grossen PDFs)
- Performance: Cache-Refresh delegiert an async Worker (refresh_all_sync blockiert UI nicht mehr)
- Performance: BiPRO-Quittierung parallelisiert (max 4 gleichzeitig bei >3 Lieferungen)
- Performance: KI-Semaphore von 5 auf 8 parallele Aufrufe erhoeht (passt zu DocumentProcessor-Workerpool)
- Bugfix: SmartScan bricht bei >10 Dateien nicht mehr ab (leere API-Antworten werden korrekt erkannt)
- Bugfix: SmartScan Retry-Logik bei Chunk-Fehlern (max 2 Wiederholungen pro Chunk)
- Bugfix: SmartScan Client-Timeout auf 330s erhoeht (>= Server-Timeout von 300s)
- Bugfix: KI-Classify Timeout von 30s auf 150s erhoeht (passt zu Server-Proxy-Timeout von 120s)
v2.2.4 (24.02.2026)
- KI-Klassifikation: Courtage-Erkennung erweitert (Buchnote, Provisionskonto, VU-Kontoauszuege, DI-Provision, Stornoreserve)
- KI-Klassifikation: VU-Sparten-Kuerzel (MKF, RR, PHV, HR, WG, UV etc.) werden im Prompt erkannt
- KI-Klassifikation: Mahnung/Rueckstandsliste wird nach Sparte des zugrundeliegenden Vertrags zugeordnet (nicht mehr "sonstige")
- KI-Klassifikation: Unfallversicherung-Erkennung verstaerkt (Beitragsinformation + Invaliditaet + Progression = sach, nicht kranken)
- KI-Klassifikation: Keyword-Hints erweitert (9 neue Courtage-Keywords, Mahnung+Sparten-Code-Erkennung)
- KI-Klassifikation: Dateinamen-basierte Courtage-Vorsortierung fuer "Vermittlerabrechnung" im Dateinamen
- OCR: Tesseract PSM-Modus von --psm 6 auf --psm 3 (fully automatic page segmentation) fuer bessere Erkennung gemischter Layouts
- OCR: DPI von 150 auf 200 erhoeht fuer bessere Scan-Qualitaet
v2.2.2 (24.02.2026)
- Bugfix: Dokumentenarchiv zeigt leere Tabelle - LIMIT 1000 in documents.php war zu niedrig (jetzt 10000, per Parameter steuerbar)
- Bugfix: Stats-Sidebar springt auf 0 - _compute_stats_from_cache() basierte auf limitierten Daten, jetzt immer Server-Stats
- Bugfix: Cache-Schutz gegen leere API-Antworten (ueberschreibt keinen guten Cache mehr)
- Bugfix: UI-Haenger durch blockierende API-Calls auf Main Thread (SmartScan-Status, Stats-Reload)
- Bugfix: Thread-Safety - Auto-Refresh nutzt eigene requests.Session statt geteilte (Race-Condition)
- Paralleler DownloadManager -Crash- bugfix
- Zero-Interaction Pflicht-Updates: Download + Installation starten vollautomatisch, neue Version startet von allein (kein Button-Klick noetig)
- Hintergrund-Updater: Prueft bei jedem PC-Start auf Updates und installiert sie still im Hintergrund (Scheduled Task + Registry-Autostart)
- BiPRO-Events: Strukturierte Metadaten aus 0-Dokument-Lieferungen (Vertragsdaten-XML, Statusmeldungen, GDV-Ankuendigungen) mit eigener Kachel in der Mitteilungszentrale
- Provisionsmanagement-Refactoring v3.4.0: Workers (24 QThread-Worker), Models (12 QAbstractTableModel), Dialogs (MatchContractDialog + DiffDialog) aus Panel-Dateien extrahiert
- TL-Rate und TL-Basis in Provisionsmodellen (pm_commission_models) fuer automatische Uebernahme beim Zuweisen
- PDF-Validierung: Reason-Codes (PDFValidationStatus) fuer technische Validierungsstatus bei BiPRO-Downloads
- BiPRO-Events-Polling: Summary-Endpoint fuer leichtgewichtiges Polling (unread_count) in NotificationPollWorker integriert
- DB-Migration 030: bipro_events Tabelle
- DB-Migration 031: tl_rate + tl_basis Felder in pm_commission_models
- Provisionsmanagement (v3.0.0)
  - Eigenstaendiger Vollbild-Hub mit 8 Panels
  - Dashboard mit 4 KPI-Karten, DonutChart, Berater-Ranking
  - VU-Provisionslisten Import (Allianz, SwissLife, VB) mit parallelem Import
  - Xempus-Beratungen Import mit Duplikat-Erkennung
  - Auto-Matching: 5+2-Schritt Batch-JOIN (~11s fuer 15.010 Zeilen)
  - Split-Engine: 3 Batch-SQL-Updates (Berater/TL/AG-Anteile)
  - Monatsabrechnungen mit Snapshot-Prinzip und Status-Workflow
  - Vermittler-Mapping (VU-Name → interner Berater)
  - 7 pm_* DB-Tabellen, 32 PHP-Endpoints
- GF-Rework (v3.1.0)
  - Komplett neues UI-Design: Shared Widgets (PillBadge, DonutChart, FilterChipBar, KpiCard, etc.)
  - Rich-Tooltips auf allen KPIs und Spalten
  - Activity-Logging fuer alle PM-Aktionen
  - Klaerfall-Counts vom Server (no_contract, unknown_vermittler, no_model, no_split)
  - Audit-Endpunkt fuer PM-Aktivitaetshistorie
- Matching V2 (v3.2.0)
  - Multi-Level Matching Engine (Score 100/90/70/40)
  - MatchContractDialog mit PillBadge-Delegates
  - VN-Normalisierung (Umlaute, Klammern, Sonderzeichen)
  - Server-seitige Pagination (page/per_page)
  - Transaktionale Zuordnung (PUT /pm/assign)
  - Reverse-Matching (Xempus-Vertraege ohne VU-Provision)
- Stabilisierung (v3.2.1)
  - 55 Befunde behoben: Transaktionen, Worker, Indizes, Validierung, UI-Fixes
  - 8 operative DB-Indizes + UNIQUE Constraints
  - 5 sync API-Calls durch QThread-Worker ersetzt
  - 20 hardcodierte Strings migriert
- Stabilisierung II (v3.2.2)
  - VSNR-Normalisierung: Alle Nullen entfernen (nicht nur fuehrende)
  - 0€-Zeilen als 'nullmeldung' importiert
  - Gefahrenzone (Settings-Panel mit 3s-Countdown-Reset)
- Xempus Insight Engine (v3.3.0)
  - 4-Phasen-Import-Pipeline (RAW → Parse → Snapshot → Finalize)
  - 9 neue xempus_* DB-Tabellen (Arbeitgeber, Tarife, Zuschuesse, ArbN, Beratungen)
  - Dediziertes xempus.php Backend (~1360 Zeilen)
  - 4-Tab UI-Panel (Arbeitgeber, Statistiken, Import, Status-Mapping)
  - Snapshot-Diff-Vergleich zwischen Import-Batches
  - Python-Parser fuer alle 5 Xempus-Excel-Sheets
  - provision_access + provision_manage Permissions (explizite Zuweisung, nicht auto-Admin)
- Grosse dateien ausgelagert
- Performance und routing verbessert
- anderes
- Dokument Regeln.
- Neu API. OpenAI API direkt angebunden um weitere Kosten zu sparen
- Provider Model
- verarbeitungsablauf konfi.
- PDF Multi auswahl.
- Sicherheits Cache wipe bei Log out.
- API, Proxy, Ablauf und Quell Rework.
- ATLAS Index ist bereit und verfügbar!
- Suche über alle Dokumente nach text inhalt, dateiname teiltreffer USW!
- Text-Extraktion fuer Inhaltsduplikat-Erkennung k
- Fehlerbehebung (Passwort-pdf und Outlook msg.)
- Bug fix.
- Vorbereitung für Spätere Features
- Leere-Seiten-Erkennung
- Neue Spalte im Dokumentenarchiv mit Markierung
- ◑ Orange: Teilweise leere Seiten (z.B. "3 von 8 Seiten leer")
- ○ Rot: Komplett leeres PDF (z.B. "Komplett leer (5 Seiten)")
- Performance-Verbesserungen
- QTableView-Migration
- Archiv-Tabelle von QTableWidget auf QTableView + QAbstractTableModel umgestellt
- Virtualisiertes Rendering: Nur sichtbare Zeilen werden gerendert (~30 statt 500+)
- Sortierung und Textsuche ueber QSortFilterProxyModel statt manueller Iteration
- Ergebnis: 531 Dokumente laden in ~0.1ms statt ~50s Freeze
- Zentrale
- Internes Nachrichtensystem
- Komplette überarbeitung.
- Delete Perfomance optmimierung
- Post Performance optimierung
- Verarbeitungs Performance optimierung
- Refresh alle 10s
- Outlook kompatibilität.
- Passwortgeschütze PDF behandlung (Zürich)
- Drag and Drop vom Explorer in die Eingangsbox.
- Zuordnung geschärft.
- Dateibehandlung verbessert.
- Kosten weiter minimiert.
- Persistentes Farbsystem
- Auto-Update-System implementiert
- Admin-Bereich mit Release-Verwaltung
- Cache-Optimierung
- Bulk-Archivierung
- Vorschau-Cache fuer schnellere PDF-Anzeige
- KI-Kosten-Tracking mit Admin-Uebersicht
- Rechte-/Session-/Activity-Management
- Neue Box für Admins um falsch sortierte Dokumente auszulagern.
- Scans implementiert.
- Release Gate Erweiterung (v3.4.1)
  - Gate 6: Schema-Struktur-Pruefung (6 kritische Tabellen, 12 Indexes, 10 Spalten, SHA256 Audit)
  - Gate 7: Daten-Integritaets-Pruefung (orphaned FKs, fehlende Berater-Referenzen, Warnungen)
  - Withdraw-Endpoint mit Auto-Fallback (POST /admin/releases/{id}/withdraw)
  - Schema-Snapshot Endpoint (GET /admin/releases/schema-snapshot)
  - Provision Unit Tests (23 Normalisierungs-Tests: normalize_vsnr, normalize_vermittler_name, normalize_for_db)
  - Erweiterte Smoke Tests (+Provision Normalisierung, +Version Consistency, +API Health Check)
  - Installer-Verifikation Script (SHA256, VERSION-Match)
  - CI-Pipeline erweitert (Provision Tests, Installer-Check, erweiterte Artifacts)
  - Admin-Panel: Zurueckziehen-Button mit Bestaetigungs-Dialog
